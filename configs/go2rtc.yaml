# =============================================================================
# go2rtc Configuration - NeuroSurveillance System v5.2
# =============================================================================
# Location: /opt/go2rtc/go2rtc.yaml
#
# IMPORTANT: Replace all {VARIABLES} with your actual values before deploying.
# See production-values reference for actual values.
#
# This configuration uses rpicam-vid streaming directly to go2rtc via stdout.
# Exec streams MUST be single-line quoted strings â€” YAML multi-line blocks
# (exec: >) do NOT work with go2rtc and will silently fail.
# =============================================================================

streams:
  # Stream name: {CAMERA_0_ID} (e.g., pi_cam_0)
  # Access via: rtsp://{PI_IP}:8554/{CAMERA_0_ID}
  {CAMERA_0_ID}: "exec:rpicam-vid -n --codec libav --libav-format mpegts --width {CAMERA_WIDTH} --height {CAMERA_HEIGHT} --framerate {CAMERA_FPS} --bitrate {CAMERA_BITRATE} --inline --intra 15 --timeout 0 --camera 0 --level 4.1 --profile high --low-latency --output -"

  # Stream name: {CAMERA_1_ID} (e.g., pi_cam_1)
  # Access via: rtsp://{PI_IP}:8554/{CAMERA_1_ID}
  {CAMERA_1_ID}: "exec:rpicam-vid -n --codec libav --libav-format mpegts --width {CAMERA_WIDTH} --height {CAMERA_HEIGHT} --framerate {CAMERA_FPS} --bitrate {CAMERA_BITRATE} --inline --intra 15 --timeout 0 --camera 1 --level 4.1 --profile high --low-latency --output -"

# RTSP server -- listens on all interfaces
# Access streams via: rtsp://{PI_IP}:8554/{stream_name}
rtsp:
  listen: ":8554"

# API / web interface -- http://{PI_IP}:1984
# Useful endpoints: /api/streams, /api/config
api:
  listen: ":1984"

# Levels: trace, debug, info, warn, error
log:
  level: info

# =============================================================================
# CONFIGURATION REFERENCE
# =============================================================================
#
# Recommended Values:
# -------------------
# | Variable          | Recommended    | Notes                               |
# |-------------------|----------------|-------------------------------------|
# | {CAMERA_WIDTH}    | 1024           | Resolution width                    |
# | {CAMERA_HEIGHT}   | 768            | Resolution height                   |
# | {CAMERA_FPS}      | 15             | Frames per second                   |
# | {CAMERA_BITRATE}  | 1500000        | 1.5 Mbps per camera                 |
# | {CAMERA_0_ID}     | pi_cam_0       | Unique stream identifier            |
# | {CAMERA_1_ID}     | pi_cam_1       | Unique stream identifier            |
#
# Resolution Presets:
# -------------------
# | Name      | Resolution | Storage/Day | Use Case                          |
# |-----------|------------|-------------|-----------------------------------|
# | HD        | 1280x720   | ~20 GB      | High detail analysis              |
# | Standard  | 1024x768   | ~16 GB      | Balanced (recommended)            |
# | Efficient | 800x600    | ~12 GB      | Long-term studies                 |
# | Minimal   | 640x480    | ~8 GB       | Extended recording                |
#
# CRITICAL WARNINGS:
# ------------------
# 1. NEVER use H.265/HEVC (--codec h265) -- causes kernel panics on Pi 5
# 2. Use --codec libav --libav-format mpegts (MPEG-TS container, H.264 encoded)
#    mpegts provides better framing and timestamps than raw h264 bitstream.
#    Recommended by RPi camera docs for streaming use cases.
# 3. --low-latency suppresses B-frames -- required for Pi 5 streaming stability
# 4. --intra 15 = 1-second keyframe interval at 15fps (fast Frigate stream startup)
# 5. -n disables preview window (required on headless Pi)
# 6. Exec strings MUST be single-line quoted strings (never YAML multi-line)
# 7. Do NOT pipe through ffmpeg (proven unstable for 24/7 operation)
# 8. Install rpicam-apps (full), NOT rpicam-apps-lite (lite lacks libav codec)
#
# =============================================================================
